FROM rust:alpine as init-builder
WORKDIR /library-checker-init
COPY init /library-checker-init
RUN cargo build --release --target=x86_64-unknown-linux-musl

FROM ubuntu:24.04

RUN apt-get update \
    && apt-get install -y --no-install-recommends ldc=1:1.36.0-2ubuntu2 gcc libc6-dev \
    && rm -rf /var/lib/apt/lists/*

COPY --from=init-builder /library-checker-init/target/x86_64-unknown-linux-musl/release/library-checker-init /usr/bin

LABEL library-checker-image=true
